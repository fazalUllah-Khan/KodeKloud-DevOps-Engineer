The Nautilus DevOps team has some data on each app server in Stratos DC that they want to copy to a different location. However, they want to create an archive of the data first, then they want to copy the same to a different location on the respective app server. Additionally, there are some specific requirements for each server. Perform the task using Ansible playbook as per requirements mentioned below:


Create a playbook named playbook.yml under /home/thor/ansible directory on jump host, an inventory file is already placed under /home/thor/ansible/ directory on Jump Server itself.

1.	Create an archive media.tar.gz (make sure archive format is tar.gz) of /usr/src/dba/ directory ( present on each app server ) and copy it to /opt/dba/ directory on all app servers. The user and group owner of archive media.tar.gz should be tony for App Server 1, steve for App Server 2 and banner for App Server 3.

Note: Validation will try to run playbook using command ansible-playbook -i inventory playbook.yml so please make sure playbook works this way, without passing any extra arguments.

# Solution:
thor@jump_host ~$ cd /home/thor/ansible/
thor@jump_host ~/ansible$ ansible all -a "ls -ltr /opt/dba" -i inventory
stapp03 | CHANGED | rc=0 >>
total 0
stapp02 | CHANGED | rc=0 >>
total 0
stapp01 | CHANGED | rc=0 >>
total 0
thor@jump_host ~/ansible$ vi /home/thor/ansible/playbook.yml
thor@jump_host ~/ansible$ cat /home/thor/ansible/playbook.yml
- name: Task create archive and copy to host
  hosts: stapp01, stapp02, stapp03
  become: yes
  tasks:
    - name: As per the task create the archive file and set the owner
      archive:
        path: /usr/src/dba/
        dest: /opt/dba/media.tar.gz
        format: gz
        force_archive: true
        owner: "{{ ansible_user }}"
        group: "{{ ansible_user }}"
thor@jump_host ~/ansible$ ansible-playbook  -i inventory playbook.yml

PLAY [Task create archive and copy to host] **********************************************************

TASK [Gathering Facts] *******************************************************************************
ok: [stapp02]
ok: [stapp01]
ok: [stapp03]

TASK [As per the task create the archive file and set the owner] *************************************
changed: [stapp03]
changed: [stapp01]
changed: [stapp02]

PLAY RECAP *******************************************************************************************
stapp01                    : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
stapp02                    : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
stapp03                    : ok=2    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

thor@jump_host ~/ansible$ ansible all -a "ls -ltr /opt/dba" -i inventory
stapp02 | CHANGED | rc=0 >>
total 4
-rw-r--r-- 1 steve steve 171 Mar 28 22:01 media.tar.gz
stapp03 | CHANGED | rc=0 >>
total 4
-rw-r--r-- 1 banner banner 158 Mar 28 22:01 media.tar.gz
stapp01 | CHANGED | rc=0 >>
total 4
-rw-r--r-- 1 tony tony 162 Mar 28 22:01 media.tar.gz
thor@jump_host ~/ansible$
